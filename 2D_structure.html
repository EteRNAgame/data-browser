<head>
  <title>EteRNA - Played by Humans. Scored by Nature.</title>
  <script>

  // returns a zero-parameter closure with seq bound

// There's rerally no justification for a closure
//  function putSequence( seq, title ) {
//    console.log( "Setting sequence to " + seq + " and title to " + title );

    // Delay setting parameters until flash app is ready

    function putTitleSecond () {
      var applet = document.getElementById('maingame');
      if (!applet || !applet.set_sequence_string) {
        setTimeout( putTitleSecond, 200 );
        console.log( "waiting for initialization to complete" )
        return;
      }
    
      try {
        applet.set_design_title( options.title );
      } catch (error) {
        console.log( "retrying design_title" );
        setTimeout( putTitleSecond, 200 );
        return;
      }
      console.log( "Flash parameters set" );
    }

    function putSequenceFirst () {
      var applet = document.getElementById('maingame');
      if (!applet || !applet.set_sequence_string ) {
        setTimeout( putSequenceFirst, 200 );
        console.log( "waiting for initialization to complete" )
        return;
      }

      applet.set_sequence_string( options.sequence );
      console.log( "Sequence set " );
      putTitleSecond();
    }


    // Start things off
    //putSequenceFirst();
    //return;
  //}

  // parse parameters
  var options = {}
  location.search.replace(/\?/,"").split("&").map( function(x){ 
    var temp = x.split("="); if (temp.length >= 2) 
    options[temp[0].trim().toLowerCase()] = decodeURIComponent( temp[1].trim() ); 
  });

  //window.addEventListener("load", function(event) {
  document.addEventListener("DOMContentLoaded", function(event) {
    console.log("DOM fully loaded and parsed; Puzzlequery string is " + location.search.substr(1));
    document.body.outerHTML = 
    '<body style="padding:0px; margin:0px">  <embed id="maingame" src="http://staging.eternagame.org/eterna_resources/Eterna123.swf" width="100%" height="100%" type="application/x-shockwave-flash" cache="true" bgcolor="#061A34" flashvars="inputtype=PUZZLE&inputval='
      + options.puzzleid
      + '&username=&uid=0&databrowser=true&q=index.php" allowscriptaccess="always">';  
    //putSequence( options.sequence, decodeURIComponent( options.title ) );
    putSequenceFirst();
  });
  </script>
</head>
<!--
    <body style="padding:0px; margin:0px"> 
      <embed id="maingame" src="/eterna_resources/Eterna123.swf" width="100%" height="100%" type="application/x-shockwave-flash" cache="true" bgcolor="#061A34" flashvars="inputtype=PUZZLE&inputval=3398937&username=&uid=0&databrowser=true&q=index.php" allowscriptaccess="always">  
-->    
</body>

